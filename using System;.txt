using System;

class Calculator
{
    private double memory = 0;

    public double Add(double a, double b) => a + b;
    public double Subtract(double a, double b) => a - b;
    public double Multiply(double a, double b) => a * b;
    public double Divide(double a, double b)
    {
        if (b == 0)
            throw new DivideByZeroException("Деление на ноль невозможно.");
        return a / b;
    }
    public double Modulo(double a, double b)
    {
        if (b == 0)
            throw new DivideByZeroException("Деление на ноль невозможно.");
        return a % b;
    }
    public double Reciprocal(double x)
    {
        if (x == 0)
            throw new DivideByZeroException("Деление на ноль невозможно.");
        return 1 / x;
    }
    public double HalfOf(double x) => x / 2;
    public double SquareRoot(double x)
    {
        if (x < 0)
            throw new ArgumentException("Невозможно извлечь квадратный корень из отрицательного числа.");
        return Math.Sqrt(x);
    }
    public void MemoryAdd(double x) => memory += x;
    public void MemorySubtract(double x) => memory -= x;
    public double MemoryRecall() => memory;

    public void Run()
    {
        while (true)
        {
            Console.WriteLine("\nВыберите операцию:");
            Console.WriteLine("1. Сложение (+)");
            Console.WriteLine("2. Вычитание (-)");
            Console.WriteLine("3. Умножение (×)");
            Console.WriteLine("4. Деление (÷)");
            Console.WriteLine("5. Остаток от деления (%)");
            Console.WriteLine("6. Обратное число (1/х)");
            Console.WriteLine("7. Половина числа (х/2)");
            Console.WriteLine("8. Квадратный корень (√х)");
            Console.WriteLine("9. Добавить в память (M+)");
            Console.WriteLine("10. Вычесть из памяти (M-)");
            Console.WriteLine("11. Вызвать из памяти (MR)");
            Console.WriteLine("0. Выход");

            string choice = Console.ReadLine();

            if (choice == "0") break;

            try
            {
                switch (choice)
                {
                    case "1":
                    case "2":
                    case "3":
                    case "4":
                    case "5":
                        Console.Write("Введите первое число: ");
                        double a = double.Parse(Console.ReadLine());
                        Console.Write("Введите второе число: ");
                        double b = double.Parse(Console.ReadLine());
                        switch (choice)
                        {
                            case "1": Console.WriteLine($"Результат: {Add(a, b)}"); break;
                            case "2": Console.WriteLine($"Результат: {Subtract(a, b)}"); break;
                            case "3": Console.WriteLine($"Результат: {Multiply(a, b)}"); break;
                            case "4": Console.WriteLine($"Результат: {Divide(a, b)}"); break;
                            case "5": Console.WriteLine($"Результат: {Modulo(a, b)}"); break;
                        }
                        break;
                    case "6":
                    case "7":
                    case "8":
                        Console.Write("Введите число: ");
                        double x = double.Parse(Console.ReadLine());
                        switch (choice)
                        {
                            case "6": Console.WriteLine($"Результат: {Reciprocal(x)}"); break;
                            case "7": Console.WriteLine($"Результат: {HalfOf(x)}"); break;
                            case "8": Console.WriteLine($"Результат: {SquareRoot(x)}"); break;
                        }
                        break;
                    case "9":
                    case "10":
                        Console.Write("Введите число: ");
                        double m = double.Parse(Console.ReadLine());
                        if (choice == "9") MemoryAdd(m);
                        else MemorySubtract(m);
                        Console.WriteLine("Операция с памятью выполнена.");
                        break;
                    case "11":
                        Console.WriteLine($"Значение в памяти: {MemoryRecall()}");
                        break;
                    default:
                        Console.WriteLine("Неверный выбор. Попробуйте снова.");
                        break;
                }
            }
            catch (FormatException)
            {
                Console.WriteLine("Ошибка: Введено некорректное число.");
            }
            catch (DivideByZeroException ex)
            {
                Console.WriteLine($"Ошибка: {ex.Message}");
            }
            catch (ArgumentException ex)
            {
                Console.WriteLine($"Ошибка: {ex.Message}");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Произошла ошибка: {ex.Message}");
            }
        }
    }

    static void Main()
    {
        Calculator calc = new Calculator();
        calc.Run();
    }
}